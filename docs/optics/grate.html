<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Grate · Proptics[_, _]</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A `Grate` is an optic which allows `zipWith` operations.&lt;br/&gt;"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Grate · Proptics[_, _]"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sagifogel.github.io/Proptics/Proptics/"/><meta property="og:description" content="A `Grate` is an optic which allows `zipWith` operations.&lt;br/&gt;"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/Proptics/img/favicon/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/Proptics/js/scrollSpy.js"></script><link rel="stylesheet" href="/Proptics/css/prism.css"/><link rel="stylesheet" href="/Proptics/css/main.css"/><script src="/Proptics/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/Proptics/"><h2 class="headerTitle">Proptics[_, _]</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/Proptics/docs/overview" target="_self">Getting Started</a></li><li class=""><a href="/Proptics/api/proptics/index.html" target="_self">API Docs</a></li><li class=""><a href="https://github.com/sagifogel/proptics" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Optics</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/Proptics/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/quick-example">Quick Example</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Optics<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/optic">Optic</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/iso">Iso</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/lens">Lens</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/prism">Prism</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/affine-traversal">AffineTraversal</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/traversal">Traversal</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/fold">Fold</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/getter">Getter</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/setter">Setter</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/review">Review</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/Proptics/docs/optics/grate">Grate</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/">Index</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/optics/at">At</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">An-Optics<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/Proptics/docs/an-optics/an-optic">AnOptic</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/an-optics/an-iso">AnIso</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/an-optics/a-lens">ALens</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/an-optics/a-prism">APrism</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/an-optics/an-affine-traversal">AnAffineTraversal</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/an-optics/a-traversal">ATraversal</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Indexed Optics<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/Proptics/docs/indexed-optics/indexed-optic">IndexedOptic</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/indexed-optics/indexed-lens">IndexedLens</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/indexed-optics/an-indexed-lens">AnIndexedLens</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/indexed-optics/indexed-traversal">IndexedTraversal</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/indexed-optics/indexed-fold">IndexedFold</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/indexed-optics/indexed-getter">IndexedGetter</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/indexed-optics/indexed-setter">IndexedSetter</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Folds<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/Proptics/docs/folds/additional-functionality-of-folds">Folds Additional Functionality</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Profunctors<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/Proptics/docs/profunctors/profunctor">Profunctor</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/profunctors/strong">Strong</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/profunctors/choice">Choice</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/profunctors/wander">Wander</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/profunctors/closed">Closed</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Data Types<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/bazaar">Bazaar</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/exchange">Exchange</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/forget">Forget</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/indexed">Indexed</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/market">Market</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/shop">Shop</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/stall">Stall</a></li><li class="navListItem"><a class="navItem" href="/Proptics/docs/data-types/tagged">Tagged</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Grate</h1></header><article><div><span><p>A <code>Grate</code> is an optic which allows <code>zipWith</code> operations.<br/></p>
<h2><a class="anchor" aria-hidden="true" id="grate-internal-encoding"></a><a href="#grate-internal-encoding" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Grate internal encoding</h2>
<h4><a class="anchor" aria-hidden="true" id="polymorphic-grate"></a><a href="#polymorphic-grate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Polymorphic Grate</h4>
<pre><code class="hljs css language-scala">Grate_<span class="token punctuation">[</span>S<span class="token punctuation">,</span> T<span class="token punctuation">,</span> A<span class="token punctuation">,</span> B<span class="token punctuation">]</span>
</code></pre>
<p><code>Grate_[S, T, A, B]</code> is a function <code>P[A, B] =&gt; P[S, T]</code> that takes a <a href="/Proptics/docs/profunctors/closed">Closed</a> of P[_, _].</p>
<pre><code class="hljs css language-scala"><span class="token comment">/**
  * @tparam S the source of a Grate_
  * @tparam T the modified source of a Grate_
  * @tparam A the focus of a Grate_
  * @tparam B the modified focus of a Grate_
  */</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> Grate_<span class="token punctuation">[</span>S<span class="token punctuation">,</span> T<span class="token punctuation">,</span> A<span class="token punctuation">,</span> B<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> apply<span class="token punctuation">[</span>P<span class="token punctuation">[</span>_<span class="token punctuation">,</span> _<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span>pab<span class="token operator">:</span> P<span class="token punctuation">[</span>A<span class="token punctuation">,</span> B<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> ev<span class="token operator">:</span> Closed<span class="token punctuation">[</span>P<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> P<span class="token punctuation">[</span>S<span class="token punctuation">,</span> T<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>Grate_[S, T, A, B]</code> changes its focus from <code>A</code> to <code>B</code>, resulting in a change of structure from <code>S</code> to <code>T</code>.</br>
A <code>Grate</code> that changes its focus/structure, is called <code>Polymorphic Grate</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="monomorphic-grate"></a><a href="#monomorphic-grate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Monomorphic Grate</h4>
<pre><code class="hljs css language-scala">Grate<span class="token punctuation">[</span>S<span class="token punctuation">,</span> A<span class="token punctuation">]</span>
</code></pre>
<p><code>Grate[S, A]</code> is a type alias for <code>Grate_[S, S, A, A]</code>, which has the same type of focus <code>A</code>, thus preserving the same type of structure <code>S</code>.</p>
<pre><code class="hljs css language-scala"><span class="token keyword">type</span> Grate<span class="token punctuation">[</span>S<span class="token punctuation">,</span> A<span class="token punctuation">]</span> <span class="token operator">=</span> Grate_<span class="token punctuation">[</span>S<span class="token punctuation">,</span> S<span class="token punctuation">,</span> A<span class="token punctuation">,</span> A<span class="token punctuation">]</span>
</code></pre>
<p>A <code>Grate</code> that does not change its focus/structure, is called <code>Monomorphic Grate</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="constructing-grates"></a><a href="#constructing-grates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Constructing Grates</h2>
<p><code>Grate_[S, T, A, B]</code> is constructed using the <a href="../../api/proptics/Grate_$">Grate_[S, A]#apply</a> function.<br/>
<code>Grate_[S, T, A, B]</code> takes a <code>grate</code> function, <code>((S =&gt; A) =&gt; B) =&gt; T</code>, which is a function that given a function from <code>(S =&gt; A) =&gt; B)</code> will return a <code>T</code>, that is
if we can extract an <code>A</code> out of an <code>S</code> we will get a <code>B</code> and we will have to use this <code>B</code> in order to construct a <code>T</code>.</p>
<pre><code class="hljs css language-scala"><span class="token keyword">object</span> Grate_ <span class="token punctuation">{</span>
  <span class="token keyword">def</span> apply<span class="token punctuation">[</span>S<span class="token punctuation">,</span> T<span class="token punctuation">,</span> A<span class="token punctuation">,</span> B<span class="token punctuation">]</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>S <span class="token keyword">=></span> A<span class="token punctuation">)</span> <span class="token keyword">=></span> B<span class="token punctuation">)</span> <span class="token keyword">=></span> T<span class="token punctuation">)</span><span class="token operator">:</span> Grate_<span class="token punctuation">[</span>S<span class="token punctuation">,</span> T<span class="token punctuation">,</span> A<span class="token punctuation">,</span> B<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>Grate[S, A]</code> is constructed using the <a href="../../api/proptics/Grate$">Grate[S, A]#apply</a> function.<br/>
<code>Grate[S, A]</code> takes a <code>grate</code> function, <code>((S =&gt; A) =&gt; A) =&gt; S</code>, which is a function that given a function from <code>(S =&gt; A) =&gt; A)</code> will return an <code>S</code>, that is
if we can extract an <code>A</code> out of an <code>S</code> we will get an <code>A</code> and we will have to use this <code>A</code> in order to construct a new <code>S</code>.</p>
<pre><code class="hljs css language-scala"><span class="token keyword">object</span> Grate <span class="token punctuation">{</span>
  <span class="token keyword">def</span> apply<span class="token punctuation">[</span>S<span class="token punctuation">,</span> A<span class="token punctuation">]</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>S <span class="token keyword">=></span> A<span class="token punctuation">)</span> <span class="token keyword">=></span> A<span class="token punctuation">)</span> <span class="token keyword">=></span> S<span class="token punctuation">)</span><span class="token operator">:</span> Grate<span class="token punctuation">[</span>S<span class="token punctuation">,</span> A<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A simple example would be the accumulation of two tuples of ints <code>(Int, Int)</code></p>
<pre><code class="hljs css language-scala"><span class="token keyword">import</span> <span class="token namespace">proptics<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Grate<span class="token punctuation">,</span> Grate_<span class="token punctuation">}</span>
<span class="token comment">// import proptics.{Grate, Grate_}</span>

<span class="token keyword">val</span> grateTuples <span class="token operator">=</span> Grate<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span>f <span class="token keyword">=></span> <span class="token punctuation">(</span>f<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// grateTuples: proptics.Grate[(Int, Int),Int] = proptics.Grate_$$anon$5@703a4e5</span>

grateTuples<span class="token punctuation">.</span>zipWith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>
<span class="token comment">//res0: (Int, Int) = (9,9)</span>
</code></pre>
<p>In this example the <code>Grate</code> optic takes a function <code>f</code> in the form of</p>
<pre><code class="hljs">(((<span class="hljs-keyword">Int</span>, <span class="hljs-keyword">Int</span>)) =&gt; <span class="hljs-keyword">Int</span>) =&gt; <span class="hljs-keyword">Int</span>)
</code></pre>
<p>and its return type is <code>Int</code>, which means that we need to supply a function <code>(Int, Int) =&gt; Int</code> In order to get an <code>Int</code>,
which we will use to construct a new <code>(Int, Int)</code>, so we apply our function twice for each side of the tuple, and we will get two <code>Int</code>s.</p>
<pre><code class="hljs css language-scala">f <span class="token keyword">=></span> <span class="token punctuation">(</span>f<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="intuition"></a><a href="#intuition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Intuition</h2>
<p>We will try to gain some intuition using an example. Let's assume that we developed a successful recommendation service for TV series and
in order to interact with our system, one must create an HTTP Request to our recommendation service.</p>
<pre><code class="hljs css language-scala"><span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>syntax<span class="token punctuation">.</span>option<span class="token punctuation">.</span></span>_
<span class="token comment">// import cats.syntax.option._</span>

<span class="token keyword">case</span> <span class="token keyword">class</span> Request<span class="token punctuation">(</span>id<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queryString<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> Map<span class="token punctuation">.</span>empty<span class="token punctuation">)</span>
<span class="token comment">// defined class Request</span>

<span class="token keyword">sealed</span> <span class="token keyword">trait</span> Response
<span class="token comment">// defined trait Response</span>

<span class="token keyword">case</span> <span class="token keyword">class</span> Ok<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">(</span>value<span class="token operator">:</span> A<span class="token punctuation">)</span> <span class="token keyword">extends</span> Response
<span class="token comment">// defined class Ok</span>

<span class="token keyword">case</span> <span class="token keyword">object</span> NoContent <span class="token keyword">extends</span> Response
<span class="token comment">// defined object NoContent</span>

<span class="token comment">// recommendation service</span>
<span class="token keyword">def</span> recommendation<span class="token punctuation">(</span>seriesId<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Option<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  seriesId<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>seriesMap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>_<span class="token punctuation">)</span> orElse List<span class="token punctuation">.</span>empty<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">.</span>some<span class="token punctuation">)</span>
<span class="token comment">// recommendation: (seriesId: Option[String])Option[List[String]]</span>

<span class="token comment">// client</span>
<span class="token keyword">def</span> recommendationRoute<span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Response <span class="token operator">=</span>
  recommendation<span class="token punctuation">(</span>request<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>fold<span class="token punctuation">(</span>NoContent<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> list @ _ <span class="token operator">::</span> _ <span class="token keyword">=></span> Ok<span class="token punctuation">(</span>list<span class="token punctuation">)</span>
    <span class="token keyword">case</span> _             <span class="token keyword">=></span> NoContent
  <span class="token punctuation">}</span>
<span class="token comment">// recommendationRoute: (request: Request)Response</span>

<span class="token keyword">val</span> seriesMap<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
  <span class="token string">"tt0903747"</span> <span class="token operator">-></span> List<span class="token punctuation">(</span><span class="token string">"True Detective"</span><span class="token punctuation">,</span> <span class="token string">"Fargo"</span><span class="token punctuation">,</span> <span class="token string">"Dexter"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">"tt2356777"</span> <span class="token operator">-></span> List<span class="token punctuation">(</span><span class="token string">"Breaking Bad"</span><span class="token punctuation">,</span> <span class="token string">"Fargo"</span><span class="token punctuation">,</span> <span class="token string">"Dexter"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">"tt2802850"</span> <span class="token operator">-></span> List<span class="token punctuation">(</span><span class="token string">"Breaking Bad"</span><span class="token punctuation">,</span> <span class="token string">"True Detective"</span><span class="token punctuation">,</span> <span class="token string">"Dexter"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">"tt0773262"</span> <span class="token operator">-></span> List<span class="token punctuation">(</span><span class="token string">"Breaking Bad"</span><span class="token punctuation">,</span> <span class="token string">"True Detective"</span><span class="token punctuation">,</span> <span class="token string">"Fargo"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// seriesMap: Map[String,List[String]] = </span>
<span class="token comment">//   Map(tt0903747 -> List(True Detective, Fargo, Dexter), </span>
<span class="token comment">//   tt2356777 -> List(Breaking Bad, Fargo, Dexter), </span>
<span class="token comment">//   tt2802850 -> List(Breaking Bad, True Detective, Dexter), </span>
<span class="token comment">//   tt0773262 -> List(Breaking Bad, True Detective, Fargo))</span>

recommendationRoute<span class="token punctuation">(</span>Request<span class="token punctuation">(</span><span class="token string">"tt2356777"</span><span class="token punctuation">.</span>some<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res0: Response = Ok(List(Breaking Bad, Fargo, Dexter))</span>

recommendationRoute<span class="token punctuation">(</span>Request<span class="token punctuation">(</span><span class="token string">"tt23567771"</span><span class="token punctuation">.</span>some<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res1: Response = NoContent</span>
</code></pre>
<p>At some point of time a new requirement to secure the system has been requested. We can use <code>Grate</code> in order to add
additional logic prior to querying our recommendation service. <code>Grate</code> takes a <a href="/Proptics/docs/profunctors/closed">Closed</a> Profunctor</p>
<pre><code class="hljs css language-scala"><span class="token keyword">trait</span> Closed<span class="token punctuation">[</span>P<span class="token punctuation">[</span>_<span class="token punctuation">,</span> _<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> Profunctor<span class="token punctuation">[</span>P<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> closed<span class="token punctuation">[</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> C<span class="token punctuation">]</span><span class="token punctuation">(</span>pab<span class="token operator">:</span> P<span class="token punctuation">[</span>A<span class="token punctuation">,</span> B<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> P<span class="token punctuation">[</span>C <span class="token keyword">=></span> A<span class="token punctuation">,</span> C <span class="token keyword">=></span> B<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>Closed</code> profunctor defines a <code>closed</code> method. We will specialize the <code>P[_, _]</code> type constructor to the <code>Function</code> type. Now the type signatures
of <code>closed</code> methods is:</p>
<pre><code class="hljs css language-scala"><span class="token keyword">def</span> closed<span class="token punctuation">[</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> C<span class="token punctuation">]</span><span class="token punctuation">(</span>pab<span class="token operator">:</span> A <span class="token keyword">=></span> B<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>C <span class="token keyword">=></span> A<span class="token punctuation">)</span> <span class="token keyword">=></span> C <span class="token keyword">=></span> B
</code></pre>
<p>Consider the <code>A</code> an input and the <code>B</code> an output, the <code>closed</code> method lets us close/lock a computation <br/> from <code>A -&gt; B</code> using
a lock of <code>C</code>. once we release the lock we can use our computation to acquire a <code>B</code>. The lock can be a function that authenticates the user, and  once
the user is authenticated, we could release the lock and use the recommendation service. In order to lock the recommendation service, we need
to create a polymorphic <code>Grate</code> such that it can convert between <code>Request</code> and <code>Response</code></p>
<pre><code class="hljs css language-scala">S <span class="token operator">~</span> Request <span class="token comment">// initial structure</span>
T <span class="token operator">~</span> Response <span class="token comment">// modified structure</span>
A <span class="token operator">~</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token comment">// initial focus</span>
B <span class="token operator">~</span> Option<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">// modified focus </span>
</code></pre>
<p>The <code>grate</code> function would become</p>
<pre><code class="hljs css language-scala"><span class="token punctuation">(</span><span class="token punctuation">(</span>Request <span class="token keyword">=></span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=></span> Option<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=></span> Response
</code></pre>
<pre><code class="hljs css language-scala"><span class="token keyword">case</span> <span class="token keyword">object</span> Forbidden <span class="token keyword">extends</span> Response
<span class="token comment">// defined object Forbidden</span>

<span class="token keyword">def</span> extractSeriesId<span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  req<span class="token punctuation">.</span>queryString<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatMap <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"123456"</span> <span class="token keyword">=></span> req<span class="token punctuation">.</span>id orElse <span class="token string">""</span><span class="token punctuation">.</span>some
    <span class="token keyword">case</span> _        <span class="token keyword">=></span> None
  <span class="token punctuation">}</span>
<span class="token comment">// extractSeriesId: (req: Request)Option[String]</span>

<span class="token comment">//  grate: ((Request => Option[String]) => Option[List[String]]) => Response</span>
<span class="token keyword">def</span> mkRequest<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>Request <span class="token keyword">=></span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=></span> Option<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Response <span class="token operator">=</span>
  f<span class="token punctuation">(</span>extractSeriesId<span class="token punctuation">)</span> <span class="token keyword">match</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> Some<span class="token punctuation">(</span>ls @ _ <span class="token operator">::</span> _<span class="token punctuation">)</span> <span class="token keyword">=></span> Ok<span class="token punctuation">(</span>ls<span class="token punctuation">)</span>
    <span class="token keyword">case</span> Some<span class="token punctuation">(</span>_<span class="token punctuation">)</span>           <span class="token keyword">=></span> NoContent
    <span class="token keyword">case</span> _                 <span class="token keyword">=></span> Forbidden
  <span class="token punctuation">}</span>
<span class="token comment">// mkRequest: (f: (Request => Option[String]) => Option[List[String]])Response</span>

<span class="token keyword">val</span> grate<span class="token operator">:</span> Grate_<span class="token punctuation">[</span>Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Option<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Grate_<span class="token punctuation">(</span>mkRequest<span class="token punctuation">)</span>
<span class="token comment">// grate: Grate_[Request,Response,Option[String],Option[List[String]]] = Grate_$$anon$5@1bfd0b08</span>

<span class="token comment">// client</span>
<span class="token keyword">def</span> recommendationRoute<span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> Response <span class="token operator">=</span>
  grate<span class="token punctuation">.</span>over<span class="token punctuation">(</span>recommendation<span class="token punctuation">)</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment">// recommendationRoute: (request: Request)Response</span>

recommendationRoute<span class="token punctuation">(</span>Request<span class="token punctuation">(</span><span class="token string">"tt2356777"</span><span class="token punctuation">.</span>some<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res2: Response = Forbidden</span>

recommendationRoute<span class="token punctuation">(</span>Request<span class="token punctuation">(</span><span class="token string">"tt2356777"</span><span class="token punctuation">.</span>some<span class="token punctuation">,</span> queryString <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"password"</span> <span class="token operator">-></span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res3: Response = Ok(List(Breaking Bad, Fargo, Dexter))</span>

recommendationRoute<span class="token punctuation">(</span>Request<span class="token punctuation">(</span><span class="token string">"tt23567771"</span><span class="token punctuation">.</span>some<span class="token punctuation">,</span> queryString <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"password"</span> <span class="token operator">-></span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res4: Response = NoContent</span>

recommendationRoute<span class="token punctuation">(</span>Request<span class="token punctuation">(</span>None<span class="token punctuation">,</span> queryString <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"password"</span> <span class="token operator">-></span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res5: Response = NoContent</span>
</code></pre>
<p>We created an <code>extractSeriesId</code> method which unlocks the service by sending <code>Some</code> to the recommendation service
when the user is authenticated, or <code>None</code> otherwise. We created another <code>Response</code> type <code>Forbidden</code>, in order to respond when
the authentication process fails, moreover we created a <code>Grate</code> optic which uses the <code>mkRequest</code> as its <code>grate</code> method.</p>
<pre><code class="hljs css language-scala"><span class="token keyword">val</span> grate<span class="token operator">:</span> Grate_<span class="token punctuation">[</span>Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Option<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Grate_<span class="token punctuation">(</span>mkRequest<span class="token punctuation">)</span> 
</code></pre>
<p>The client now uses our <code>Grate</code> instance instead of calling the recommendation service directly.</p>
<h2><a class="anchor" aria-hidden="true" id="common-functions-of-a-grate"></a><a href="#common-functions-of-a-grate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Common functions of a Grate</h2>
<h4><a class="anchor" aria-hidden="true" id="review"></a><a href="#review" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>review</h4>
<pre><code class="hljs css language-scala">grate<span class="token punctuation">.</span>review<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token string">"True Detective"</span><span class="token punctuation">,</span> <span class="token string">"Fargo"</span><span class="token punctuation">,</span> <span class="token string">"Dexter"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>some<span class="token punctuation">)</span>
<span class="token comment">// res6: Response = Ok(List(True Detective, Fargo, Dexter))</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="set"></a><a href="#set" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>set</h4>
<pre><code class="hljs css language-scala">grate<span class="token punctuation">.</span>set<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token string">"True Detective"</span><span class="token punctuation">,</span> <span class="token string">"Fargo"</span><span class="token punctuation">,</span> <span class="token string">"Dexter"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>some<span class="token punctuation">)</span><span class="token punctuation">(</span>Request<span class="token punctuation">(</span>None<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res7: Response = Ok(List(True Detective, Fargo, Dexter))</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="over"></a><a href="#over" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>over</h4>
<pre><code class="hljs css language-scala">grate<span class="token punctuation">.</span>over<span class="token punctuation">(</span>recommendation<span class="token punctuation">)</span><span class="token punctuation">(</span>Request<span class="token punctuation">(</span>None<span class="token punctuation">,</span> queryString <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"password"</span> <span class="token operator">-></span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// res8: Response = NoContent</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="zipwith"></a><a href="#zipwith" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>zipWith</h4>
<pre><code class="hljs css language-scala"><span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>instances<span class="token punctuation">.</span>list<span class="token punctuation">.</span></span>_ <span class="token comment">// for semigroup</span>
<span class="token comment">// import cats.instances.list._</span>

<span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>syntax<span class="token punctuation">.</span>semigroup<span class="token punctuation">.</span></span>_
<span class="token comment">// import cats.syntax.semigroup._</span>
  
<span class="token keyword">val</span> request1 <span class="token operator">=</span> Request<span class="token punctuation">(</span><span class="token string">"tt2356777"</span><span class="token punctuation">.</span>some<span class="token punctuation">,</span> Map<span class="token punctuation">(</span><span class="token string">"password"</span> <span class="token operator">-></span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// request1: Request(Some(tt2356777),Map(password -> 123456))</span>

<span class="token keyword">val</span> request2 <span class="token operator">=</span> Request<span class="token punctuation">(</span><span class="token string">"tt0773262"</span><span class="token punctuation">.</span>some<span class="token punctuation">,</span> Map<span class="token punctuation">(</span><span class="token string">"password"</span> <span class="token operator">-></span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// request2: Request(Some(tt0773262),Map(password -> 123456))</span>

grate<span class="token punctuation">.</span>zipWith<span class="token punctuation">(</span>request1<span class="token punctuation">,</span> request2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token punctuation">(</span>None<span class="token punctuation">,</span> None<span class="token punctuation">)</span> <span class="token keyword">=></span> None
  <span class="token keyword">case</span> <span class="token punctuation">(</span>op1<span class="token punctuation">,</span> op2<span class="token punctuation">)</span>   <span class="token keyword">=></span> recommendation<span class="token punctuation">(</span>op1<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token operator">|</span> recommendation<span class="token punctuation">(</span>op2<span class="token punctuation">)</span> map <span class="token punctuation">(</span>_<span class="token punctuation">.</span>toSet<span class="token punctuation">.</span>toList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// res9: Response = Ok(List(Breaking Bad, Fargo, Dexter, True Detective))</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="laws"></a><a href="#laws" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Laws</h2>
<p>A <code>Grate</code> must satisfy all <a href="../../api/proptics/law/GrateLaws">GrateLaws</a>. These laws reside in the &lt;a href=&quot;../../api/proptics/law/&gt;proptics.law</a> package.<br/></p>
<pre><code class="hljs css language-scala"><span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span></span>Eq
<span class="token comment">// import cats.Eq</span>

<span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>instances<span class="token punctuation">.</span>int<span class="token punctuation">.</span></span>_
<span class="token comment">// import cats.instances.int._</span>

<span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>syntax<span class="token punctuation">.</span>eq<span class="token punctuation">.</span></span>_ <span class="token comment">// // triple equals operator (===)</span>
<span class="token comment">// import cats.syntax.eq._</span>

<span class="token keyword">import</span> <span class="token namespace">proptics<span class="token punctuation">.</span></span>Grate
<span class="token comment">// import proptics.Grate</span>

<span class="token keyword">import</span> <span class="token namespace">proptics<span class="token punctuation">.</span>profunctor<span class="token punctuation">.</span></span>Closed<span class="token punctuation">.</span>closedFunction
<span class="token comment">// import proptics.profunctor.Closed.closedFunction</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="identity"></a><a href="#identity" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>identity</h4>
<pre><code class="hljs css language-scala"><span class="token keyword">def</span> identityLaw<span class="token punctuation">[</span>S<span class="token punctuation">,</span> A<span class="token operator">:</span> Eq<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token operator">:</span> A<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span>
  Grate<span class="token punctuation">.</span>id<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">(</span>identity<span class="token punctuation">[</span>A<span class="token punctuation">]</span> _<span class="token punctuation">)</span><span class="token punctuation">(</span>closedFunction<span class="token punctuation">)</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> a

identityLaw<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token comment">// res0: Boolean = true</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="composition"></a><a href="#composition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>composition</h4>
<pre><code class="hljs css language-scala"><span class="token keyword">def</span> composeOver<span class="token punctuation">[</span>S<span class="token operator">:</span> Eq<span class="token punctuation">,</span> A<span class="token punctuation">]</span><span class="token punctuation">(</span>grate<span class="token operator">:</span> Grate<span class="token punctuation">[</span>S<span class="token punctuation">,</span> A<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token operator">:</span> S<span class="token punctuation">)</span><span class="token punctuation">(</span>f<span class="token operator">:</span> A <span class="token keyword">=></span> A<span class="token punctuation">)</span><span class="token punctuation">(</span>g<span class="token operator">:</span> A <span class="token keyword">=></span> A<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span>
  grate<span class="token punctuation">.</span>over<span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">(</span>grate<span class="token punctuation">.</span>over<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> grate<span class="token punctuation">.</span>over<span class="token punctuation">(</span>g compose f<span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

composeOver<span class="token punctuation">(</span>Grate<span class="token punctuation">.</span>id<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>identity<span class="token punctuation">)</span>
<span class="token comment">// res1: Boolean = true</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/Proptics/docs/optics/review"><span class="arrow-prev">← </span><span>Review</span></a><a class="docs-next button" href="/Proptics/docs/optics/index"><span>Index</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#grate-internal-encoding">Grate internal encoding</a></li><li><a href="#constructing-grates">Constructing Grates</a></li><li><a href="#intuition">Intuition</a></li><li><a href="#common-functions-of-a-grate">Common functions of a Grate</a></li><li><a href="#laws">Laws</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/Proptics/" class="nav-home"></a><div></div><div><h5>Docs</h5><a href="/Proptics/api/proptics/index.html">API Docs</a></div><div><h5>More</h5><a href="https://github.com/sagifogel/proptics">GitHub</a><a class="github-button" href="https://github.com/sagifogel/proptics" data-icon="octicon-star" data-count-href="/sagifogel/proptics" data-show-count="true" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2022 Sagi Fogel (foldl)</section></footer></div></body></html>